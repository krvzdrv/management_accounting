# Инструкция по использованию скрипта настройки

## Как использовать скрипт

### Шаг 1: Создайте новую Google Таблицу
1. Откройте [Google Sheets](https://sheets.google.com)
2. Создайте новую таблицу
3. Дайте ей название, например "Управленческий учет Алюминею"

### Шаг 2: Откройте редактор скриптов
1. В меню выберите **Расширения** → **Apps Script**
2. Откроется редактор скриптов Google Apps Script

### Шаг 3: Вставьте скрипт
1. Удалите весь код по умолчанию (функция `myFunction`)
2. Скопируйте весь код из файла `setup_script.gs`
3. Вставьте его в редактор скриптов
4. Сохраните проект (Ctrl+S или Cmd+S)
5. Дайте проекту название, например "Setup Accounting System"

### Шаг 4: Запустите скрипт
1. В редакторе скриптов выберите функцию `setupAccountingSystem` из выпадающего списка функций
2. Нажмите кнопку **Выполнить** (▶️)
3. При первом запуске Google запросит разрешения:
   - Нажмите **Проверить разрешения**
   - Выберите свой аккаунт
   - Нажмите **Дополнительно** → **Перейти к [название проекта] (небезопасно)**
   - Нажмите **Разрешить**
4. Скрипт выполнится и создаст все необходимые листы

### Шаг 5: Проверьте результат
После выполнения скрипта в вашей таблице будут созданы следующие листы:

**Справочники:**
- ✅ Контрагенты (с начальными данными)
- ✅ Товары
- ✅ Валюты (EUR, PLN)
- ✅ Категории расходов (с примерами)

**Таблицы операций:**
- ✅ Закупки (с формулами расчета)
- ✅ Продажи (с формулами расчета)
- ✅ Расходы (с формулами расчета)
- ✅ Движения денег (с формулами расчета)

**Отчеты:**
- ✅ Взаиморасчеты (кто кому должен)
- ✅ P&L (прибыль и убыток)
- ✅ Остатки (складские остатки)
- ✅ Статистика расходов
- ✅ Финансирование (кто за что платил)

## Что делает скрипт

1. **Создает все необходимые листы** с правильными названиями
2. **Добавляет заголовки колонок** во все таблицы
3. **Настраивает формулы** для автоматических расчетов:
   - Расчет сумм с НДС и без НДС
   - Пересчет в базовую валюту (EUR)
   - Расчет взаиморасчетов между компаниями
   - Расчет остатков товаров
4. **Добавляет начальные данные** в справочники:
   - Контрагенты (Алюминею, Версатрейд, Flexy, Посредник, Завод)
   - Валюты (EUR, PLN)
   - Категории расходов
5. **Настраивает форматирование**:
   - Заголовки выделены цветом
   - Форматы чисел и дат
   - Ширина колонок
   - Замороженная первая строка
6. **Добавляет валидацию данных**:
   - Выпадающие списки для валют
   - Выпадающие списки для статусов
   - Проверка ID контрагентов и товаров

## Настройка после запуска

### 1. Добавьте товары
Откройте лист **Товары** и добавьте вашу номенклатуру:
- ID (начните с 1)
- Артикул
- Название
- Единица измерения (м, шт, кг)

### 2. Обновите курсы валют
В листе **Валюты** обновите курсы валют на актуальные даты

### 3. Добавьте клиентов
В листе **Контрагенты** добавьте ваших клиентов (ID начните с 6)

### 4. Начните вводить данные
- Вводите закупки в лист **Закупки**
- Вводите продажи в лист **Продажи**
- Вводите расходы в лист **Расходы**
- Вводите движения денег в лист **Движения денег**

Все расчеты будут выполняться автоматически!

## Важные моменты

⚠️ **Кто оплатил** - критически важное поле для отслеживания взаиморасчетов:
- Если Версатрейд оплатила закупку, укажите "Версатрейд" в поле "Кто оплатил"
- Это автоматически создаст задолженность Алюминею перед Версатрейд

⚠️ **Валюты** - все суммы автоматически пересчитываются в EUR на основе курсов из листа "Валюты"

⚠️ **НДС** - хранится отдельно, но в отчетах показывается без НДС

⚠️ **Формулы** - при добавлении новых строк, скопируйте формулы из предыдущей строки (или используйте автозаполнение)

## Решение проблем

### Скрипт не запускается
- Убедитесь, что вы дали все необходимые разрешения
- Проверьте, что функция `setupAccountingSystem` выбрана в выпадающем списке

### Формулы не работают
- Убедитесь, что названия листов точно совпадают с теми, что в формулах
- Проверьте, что данные введены в правильном формате

### Ошибки в отчетах
- Убедитесь, что в таблицах операций есть данные
- Проверьте, что ID контрагентов и товаров существуют в справочниках

## Дополнительная настройка (опционально)

### Защита формул
1. Выделите диапазон с формулами в отчетах
2. Правой кнопкой → **Защитить диапазон**
3. Только вы сможете редактировать формулы

### Условное форматирование
Можно добавить цветовую индикацию для статусов:
- Зеленый для "Оплачено"
- Красный для "Не оплачено"

### Дашборд
Создайте отдельный лист с ключевыми показателями:
- Текущая прибыль
- Общая задолженность
- Остатки товаров на сумму

