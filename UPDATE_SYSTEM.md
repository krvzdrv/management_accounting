# –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. VersionManager.gs
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é —Å–∏—Å—Ç–µ–º—ã
- –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤–µ—Ä—Å–∏–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 2. UpdateManager.gs
- –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–æ–≤

### 3. MigrationScripts.gs
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –Ω–æ–≤—É—é
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
const versionInfo = getVersionInfo();
Logger.log(versionInfo);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
const updateCheck = checkForUpdates();
if (updateCheck.needsUpdate) {
  Logger.log('–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –≤–µ—Ä—Å–∏–∏: ' + updateCheck.latestVersion);
}

// –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
updateSystem();
```

### –ß–µ—Ä–µ–∑ –º–µ–Ω—é

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–µ–Ω—é:
```
üíº –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π —É—á–µ—Ç ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
```

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é

–í `VersionManager.gs`:
```javascript
const VERSION_CONFIG = {
  CURRENT_VERSION: '2.1.0', // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
  VERSION_HISTORY: [
    // ... –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏
    {
      version: '2.1.0',
      date: '2025-01-20',
      description: '–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π'
    }
  ]
};
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–í `MigrationScripts.gs`:
```javascript
function migration_2_0_to_2_1() {
  logInfo('Starting migration 2.0.0 -> 2.1.0');
  
  // 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–∞
  updateSheetStructure('Sales', [
    'order_number', 'order_date', 
    'new_field', // –ù–æ–≤–æ–µ –ø–æ–ª–µ
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  ], {
    defaultValues: {
      'new_field': '' // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
  });
  
  // 2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É–ª—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  updateSheetFormulas('Sales', [
    {
      range: 'Q2:Q1000',
      action: 'set',
      formula: '=P2*R2/100' // –ù–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞
    }
  ]);
  
  logInfo('Migration 2.0.0 -> 2.1.0 completed');
}
```

### –®–∞–≥ 3: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–í `UpdateManager.gs`, —Ñ—É–Ω–∫—Ü–∏—è `getAllMigrations()`:
```javascript
function getAllMigrations() {
  return [
    // ... –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
    {
      name: 'migration_2_0_to_2_1',
      fromVersion: '2.0.0',
      toVersion: '2.1.0',
      description: '–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π',
      execute: migration_2_0_to_2_1
    }
  ];
}
```

## –¢–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–∏—Å—Ç–∞

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫:
```javascript
updateSheetStructure('Sales', newHeaders, {
  defaultValues: {
    'new_column': ''
  },
  createIfNotExists: true
});
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª

```javascript
updateSheetFormulas('Sales', [
  {
    range: 'R2:R1000',
    action: 'set',
    formula: '=Q2*S2/100'
  }
]);
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```javascript
// –ü—Ä–∏–º–µ—Ä: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ª–∏—Å—Ç–æ–≤ –≤ –æ–¥–∏–Ω
function migrateData() {
  const oldData = getOldSheetData();
  const newData = transformData(oldData);
  writeToNewSheet(newData);
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è:
- –ù–∞–∑–≤–∞–Ω–∏–µ: `Backup_YYYY-MM-DD_HH-mm-ss`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–ø–∏–∏ –≤ Properties

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```javascript
logInfo('Migration started');
logError('Migration failed', error);
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```
–í–∏–¥ ‚Üí –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

## –ü—Ä–∏–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è

```javascript
function migration_2_0_to_2_1() {
  updateSheetStructure('Sales', [
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    'new_field' // –ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ –∫–æ–Ω—Ü–µ
  ], {
    defaultValues: {
      'new_field': ''
    }
  });
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã

```javascript
function migration_2_0_to_2_1() {
  updateSheetFormulas('Sales', [
    {
      range: 'R2:R1000',
      action: 'set',
      formula: '=IF(Q2>0; Q2*S2/100; 0)'
    }
  ]);
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏

```javascript
function migration_2_0_to_2_1() {
  const sheet = getSheet('Sales');
  const oldHeader = 'old_name';
  const newHeader = 'new_name';
  
  // –ù–∞—Ö–æ–¥–∏–º –∫–æ–ª–æ–Ω–∫—É –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  const colIndex = headers.indexOf(oldHeader);
  if (colIndex !== -1) {
    sheet.getRange(1, colIndex + 1).setValue(newHeader);
  }
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
2. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

## –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è

–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤:
- `VersionManager.gs` ‚Üí `VERSION_CONFIG.CURRENT_VERSION`
- Properties Service ‚Üí `SYSTEM_VERSION`

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é:
```javascript
const version = getCurrentVersion();
Logger.log('Current version: ' + version);
```

